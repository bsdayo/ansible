#!/usr/bin/env python3

import subprocess
import time

if __name__ == "__main__":
    print("Starting mc-monitor...")
    while True:
        result = subprocess.run(
            ["du", "-sb", "/root/.minecraft/world"], capture_output=True, text=True
        )
        if result.returncode == 0:
            size = int(result.stdout.split()[0])
            with open("/var/lib/metrics/minecraft.prom", "w") as f:
                f.write(
                    f"""# Metrics generated by mc-monitor
# HELP mc_world_size_bytes Size of the Minecraft world in bytes
# TYPE mc_world_size_bytes gauge
mc_world_size_bytes {size}
"""
                )
        time.sleep(10)
